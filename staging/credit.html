<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Credit · Bishnupriya Fuels</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%232563eb'><path d='M19 5v2h-4V5h4m-6 0v2H9V5h4m-6 0v2H5V5h4m15 6v2h-4v-2h4m-6 0v2H9v-2h4m-6 0v2H5v-2h4m15 6v2h-4v-2h4m-6 0v2H9v-2h4m-6 0v2H5v-2h4'/></svg>" type="image/svg+xml" />
    <link rel="stylesheet" href="css/base.css" />
    <link rel="stylesheet" href="css/app.css" />
    <script defer src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.3"></script>
    <script defer src="js/env.js"></script>
    <script defer src="js/errorHandler.js"></script>
    <script defer src="js/cache.js"></script>
    <script defer src="js/utils.js"></script>
    <script defer src="js/supabase.js"></script>
    <script defer src="js/auth.js?v=2"></script>
    <script defer src="js/credit.js"></script>
  </head>
  <body>
    <header class="topbar">
      <div class="brand">
        <a href="dashboard.html">Bishnupriya Fuels</a>
        <span class="page-subtitle">Credit Ledger</span>
      </div>
      <button type="button" class="nav-toggle" aria-label="Toggle menu" aria-expanded="false"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M3 6h18v2H3V6zm0 5h18v2H3v-2zm0 5h18v2H3v-2z"/></svg></button>
      <nav class="nav-wrap collapsible" aria-label="Main navigation">
        <div class="nav-group-block">
          <span class="nav-group-label" tabindex="0" aria-haspopup="true" aria-expanded="false">Operations<span class="nav-chevron" aria-hidden="true"></span></span>
          <div class="nav-group" role="menu">
            <a href="dashboard.html">Dashboard</a>
            <a href="dsr.html">Meter Reading</a>
            <a href="sales-daily.html">DSR</a>
          </div>
        </div>
        <div class="nav-group-block">
          <span class="nav-group-label" tabindex="0" aria-haspopup="true" aria-expanded="false">Finance<span class="nav-chevron" aria-hidden="true"></span></span>
          <div class="nav-group" role="menu">
            <a href="credit.html">Credit</a>
            <a href="credit-overdue.html">Overdue</a>
            <a href="expenses.html">Expenses</a>
            <a href="day-closing.html">Day closing &amp; short</a>
          </div>
        </div>
        <div class="nav-group-block">
          <span class="nav-group-label" tabindex="0" aria-haspopup="true" aria-expanded="false">HR<span class="nav-chevron" aria-hidden="true"></span></span>
          <div class="nav-group" role="menu">
            <a href="attendance.html">Attendance</a>
            <a href="salary.html">Salary</a>
          </div>
        </div>
        <div class="nav-group-block">
          <span class="nav-group-label" tabindex="0" aria-haspopup="true" aria-expanded="false">Admin<span class="nav-chevron" aria-hidden="true"></span></span>
          <div class="nav-group" role="menu">
            <a href="analysis.html" data-role="admin-only" style="display:none">Analysis</a>
            <a href="settings.html" data-role="admin-only" style="display:none">Settings</a>
          </div>
        </div>
        <button id="logout-button" class="link nav-logout">Logout</button>
      </nav>
    </header>

    <main class="stack">
      <section class="card credit-intro">
        <h2>Credit ledger</h2>
        <p class="muted">Record credit sales (with Transaction Date = DSR date) and settle payments (with Settlement Date). Backdated entries are supported; DSR and outstanding use business dates only.</p>
        <div class="credit-date-glossary" role="region" aria-label="Date fields explained">
          <strong>DSR-specific dates</strong>
          <ul>
            <li><strong>Transaction date</strong> — Business date when fuel was dispensed on credit. Drives DSR and outstanding.</li>
            <li><strong>Settlement date</strong> — Business date when the customer paid (in the Action column).</li>
            <li><strong>Last paid</strong> — Most recent settlement date for this customer (updated when you Settle).</li>
          </ul>
        </div>
      </section>

      <section class="card">
        <h2>Record credit sale</h2>
        <p class="muted">Each entry is attached to a Transaction Date. Credit for a past date will appear in that day’s DSR.</p>
        <form id="credit-form" class="form">
          <div class="form-grid">
            <div class="form-field">
              <label for="customer">Customer name</label>
              <input
                id="customer"
                name="customer_name"
                type="text"
                list="customer-list"
                placeholder="Fleet owner or Temp"
                maxlength="120"
                required
              />
              <datalist id="customer-list">
                <option value="Temp">
              </datalist>
            </div>

            <div class="form-field">
              <label for="vehicle">Vehicle no.</label>
              <input
                id="vehicle"
                name="vehicle_no"
                type="text"
                placeholder="WB12AB3456"
                maxlength="32"
              />
            </div>

            <div class="form-field">
              <label for="fuel-type">Fuel type <span class="optional-label">(optional)</span></label>
              <select id="fuel-type" name="fuel_type" aria-describedby="fuel-type-hint">
                <option value="">—</option>
                <option value="MS">MS (Petrol)</option>
                <option value="HSD">HSD (Diesel)</option>
              </select>
              <span id="fuel-type-hint" class="field-hint">Defaults to HSD if left blank</span>
            </div>

            <div class="form-field">
              <label for="quantity">Quantity (L) <span class="optional-label">(optional)</span></label>
              <input
                id="quantity"
                name="quantity"
                type="number"
                step="0.001"
                min="0"
                placeholder="—"
              />
              <span class="field-hint">Defaults to 1 if left blank</span>
            </div>

            <div class="form-field">
              <label for="amount">Amount (₹)</label>
              <input
                id="amount"
                name="amount_due"
                type="number"
                step="0.01"
                min="0.01"
                placeholder="0"
                required
              />
            </div>

            <div class="form-field">
              <label for="credit-date">Transaction date</label>
              <input
                id="credit-date"
                name="credit_date"
                type="date"
                title="Business date when fuel was dispensed (DSR date)"
                aria-describedby="credit-date-hint"
              />
              <span id="credit-date-hint" class="field-hint">DSR date for this credit</span>
            </div>

            <div class="form-field">
              <label for="notes">Notes</label>
              <textarea
                id="notes"
                name="notes"
                rows="2"
                placeholder="Credit terms, reference, etc."
              ></textarea>
            </div>
          </div>

          <button type="submit">Save credit entry</button>
          <p id="credit-success" class="success hidden">Credit entry saved.</p>
          <p id="credit-error" class="error hidden"></p>
        </form>
      </section>

      <section class="card">
        <div class="card-head card-head-flex">
          <h2>Outstanding balances</h2>
          <p id="credit-ledger-summary" class="credit-ledger-summary muted" aria-live="polite"></p>
        </div>
        <div class="table-wrap">
          <table class="credit-ledger-table">
            <thead>
              <tr>
                <th>Customer</th>
                <th>Vehicle</th>
                <th>Outstanding (₹)</th>
                <th>Transaction date</th>
                <th>Last paid</th>
                <th>Notes</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="credit-table-body">
              <tr>
                <td colspan="7" class="muted">Loading…</td>
              </tr>
            </tbody>
          </table>
        </div>
      </section>
    </main>
    <footer class="app-footer">
      <p class="footer-copyright">© 2025 F&S Ventures. All rights reserved.</p>
      <p class="footer-support"><small>Support: <a href="mailto:official@fnsventures.in">official@fnsventures.in</a> · <a href="https://wa.me/919668913299">WhatsApp +91 96689 13299</a></small></p>
    </footer>
  </body>
</html>
